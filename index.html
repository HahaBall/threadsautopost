<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Threads æŠ•ç¨¿ç³»çµ±</title>
    <!-- å¼•å…¥ Supabase JS SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { font-family: sans-serif; max-width: 500px; margin: 2rem auto; padding: 0 1rem; }
        input, textarea, button { width: 100%; margin-bottom: 1rem; padding: 0.5rem; }
        button { background: #000; color: #fff; border: none; cursor: pointer; }
    </style>
</head>
<body>
    <h2>ğŸ“ æŠ•ç¨¿åˆ° Threads</h2>
    <input type="file" id="imageInput" accept="image/*">
    <textarea id="contentInput" placeholder="è¼¸å…¥è²¼æ–‡å…§å®¹..." rows="5"></textarea>
    <button onclick="submitPost()">é€å‡ºæŠ•ç¨¿</button>

    <script>
        // --- è¨­å®šå€ ---
        const SUPABASE_URL = 'https://vngzvqpkjtccifnkalmz.supabase.co';
        const SUPABASE_KEY = 'sb_publishable_ZZCE6lYbzT8fFpVNsjcgoQ_DAvnshwW';
        
        // âŒ åŸæœ¬éŒ¯èª¤çš„å¯«æ³• (åå­—è¡çª)ï¼š
        // const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        // âœ… ä¿®æ­£å¾Œçš„å¯«æ³• (æ”¹åå« supabaseClient)ï¼š
        const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        async function submitPost() {
            const fileInput = document.getElementById('imageInput');
            const content = document.getElementById('contentInput').value;
            const file = fileInput.files[0];

            if (!file || !content) {
                alert('è«‹å¡«å¯«å…§å®¹ä¸¦ä¸Šå‚³åœ–ç‰‡');
                return;
            }

            try {
                // 1. ä¸Šå‚³åœ–ç‰‡åˆ° Supabase Storage
                // æ³¨æ„ï¼šé€™è£¡éƒ½è¦æ”¹æˆç”¨ supabaseClient å‘¼å«
                const fileName = Date.now() + '_' + file.name;
                const { data: uploadData, error: uploadError } = await supabaseClient
                    .storage
                    .from('images')
                    .upload(fileName, file);

                if (uploadError) throw uploadError;

                // 2. å–å¾—åœ–ç‰‡å…¬é–‹é€£çµ
                const { data: publicUrlData } = supabaseClient
                    .storage
                    .from('images')
                    .getPublicUrl(fileName);
                
                const imageUrl = publicUrlData.publicUrl;

                // 3. å¯«å…¥è³‡æ–™åº«
                const { error: dbError } = await supabaseClient
                    .from('posts')
                    .insert([
                        { content: content, image_url: imageUrl, status: 'Pending' }
                    ]);

                if (dbError) throw dbError;

                alert('âœ… æŠ•ç¨¿æˆåŠŸï¼ç­‰å¾…å¯©æ ¸ä¸­ã€‚');
                location.reload();

            } catch (error) {
                console.error(error);
                alert('ç™¼ç”ŸéŒ¯èª¤ï¼š' + error.message);
            }
        }
    </script>
</body>
</html>
